define(["namespace","backbone","subroute","marionette","jquery","underscore","knockout",],function(n,t,i,r,u,f,e){var o=n.app;o.module("GL",function(n,t,i,r,u,f){return n.Views={},n.Views.KnockOutMvvmView=r.ItemView.extend({onShow:function(){this.viewModel.parentView=this,e.applyBindings(this.viewModel,u(this.el)[0])}}),n.Views.MvvmView=n.Views.KnockOutMvvmView,n.Post=function(n,i,r,f,e){var o="";t.Security.Models.loggedInUser.get("LoginToken")!=undefined&&t.Security.Models.loggedInUser.get("LoginToken")!="",o=t.Security.Models.loggedInUser.get("LoginToken"),u.ajax({type:"POST",url:"/services/Service.svc/Command",data:JSON.stringify({LoginToken:o,Command:{UniqueIdentifier:Math.floor(Math.random()*1e3+1),CommandName:n,JSON:JSON.stringify(i)}}),contentType:"application/json; charset=utf-8",success:function(n){if(n.IsSuccess){var t=JSON.parse(n.JSON);r&&r(t)}else f&&f(n.Message);e&&e(n)}})},n.PostItem=function(n,t,i,r,u){this.type=n,this.data=t,this.successCallback=i,this.failureCallback=r,this.finallyCallback=u,this.UniqueIdentifier=Math.floor(Math.random()*1e3+1)},n.BatchPost=function(){this.postItems=[],this.Add=function(t,i,r,u,f){var e=new n.PostItem(t,i,r,u,f);this.postItems.push(e)},this.Post=function(){var t,i;f.bindAll(this,"success","respond"),t="",n.GetLoginToken&&(t=n.GetLoginToken()),i=[],f.each(this.postItems,function(n){i.push({UniqueIdentifier:n.UniqueIdentifier,CommandName:n.type,JSON:JSON.stringify(n.data)})}),u.ajax({type:"POST",url:"/services/Service.svc/Commands",data:JSON.stringify({LoginToken:t,Commands:i}),contentType:"application/json; charset=utf-8",success:this.success})},this.success=function(n){f.each(n,this.respond)},this.respond=function(n){var t=f.find(this.postItems,function(t){return t.type==n.CommandName&&t.UniqueIdentifier==n.UniqueIdentifier}),i;n.IsSuccess?(i=JSON.parse(n.JSON),t.successCallback&&t.successCallback(i)):t.failureCallback&&t.failureCallback(n.Message),t.finallyCallback&&t.finallyCallback(n)}},n.ModuleRouter=i.SubRoute.extend({before:function(t){var i="";return(n.GetLoginToken&&(i=n.GetLoginToken()),i=="")?(this.navigate("/Security/Login/"+t,!0),!1):(this.UpdateModel(t.split("/")[0]),this.beforeRoute)?this.beforeRoute(t):!0},UpdateModel:function(n){if(t.Security.UserModules!=null){var r=t.Security.UserModules,i=r.where({ModName:n});i.length>=1&&i[0].set("IsSelected",!0)}}}),n.ModalRegion=i.Marionette.Region.extend({el:"#modal",initialize:function(){this.on("show",this.showModal,this)},getEl:function(n){var t=u(n);t.on("hidden",this.close);return t},showModal:function(n){n.on("close",this.hideModal,this);this.$el.parent().modal("show")},hideModal:function(){this.$el.parent().modal("hide")}}),n.TransitionRegion=i.Marionette.Region.extend({initialize:function(){},addBaseAnimate:function(n){n.$el.css({"-moz-transition":"margin-left .25s, margin-right .25s","-webkit-transition":"margin-left .25s, margin-right .25s","-o-transition":"margin-left .25s, margin-right .25s","-ms-transition":"margin-left .25s, margin-right .25s",transition:"margin-left .25s, margin-right .25s"})},addTransitionInit:function(n){var t={"margin-left":n.$el.parent().width()*-1+"px","margin-right":n.$el.parent().width()*1+"px"};n.$el.css(t)},removeTransitionInit:function(n){n.$el.css({"margin-left":"","margin-right":""})},addTransitionIn:function(n){n.$el.css({"margin-left":"0px","margin-right":"0px"})},removeTransitionIn:function(n){n.$el.css({"margin-left":"","margin-right":""})},addTransitionOut:function(n){var t={"margin-left":n.$el.parent().width()*1+"px","margin-right":n.$el.parent().width()*-1+"px"};n.$el.css(t)},removeTransitionOut:function(n){n.$el.css({"margin-left":"","margin-right":""})},show:function(n){var t=this,u,i;this.ensureEl(),u=n.isClosed||f.isUndefined(n.$el)||this.currentView==undefined,i=n!==this.currentView,i&&this.promiseClose(n).done(function(){t.addBaseAnimate(n),t.addTransitionInit(n),console.log("loaded added"),n.render(),(i||u)&&t.open(n),t.currentView=n;n.$el.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){n.$el.off("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd"),t.removeTransitionInit(n),console.log("loaded removed")});setTimeout(function(){t.addTransitionIn(n),console.log("displayed")},1),r.triggerMethod.call(t,"show",n),r.triggerMethod.call(n,"show")})},promiseClose:function(){var n=this,i=u.Deferred(),t;if(!n.currentView||n.currentView.isClosed)return i.resolve(),i.promise();t=this.currentView;t.$el.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){t.$el.off("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd"),n.removeTransitionOut(t),console.log("unloaded added"),n.close(),i.resolve()});return n.removeTransitionIn(t),n.addTransitionOut(t),console.log("ondisplay removed unloaded added"),i.promise()}}),n.SlideInOutTransitionRegion=n.TransitionRegion.extend({addBaseAnimate:function(n){n.$el.addClass("baseAnimation")},addTransitionInit:function(n){n.$el.addClass("loaded")},removeTransitionInit:function(n){n.$el.removeClass("loaded")},addTransitionIn:function(n){n.$el.addClass("ondisplay")},removeTransitionIn:function(n){n.$el.removeClass("ondisplay")},addTransitionOut:function(n){n.$el.addClass("unloaded")},removeTransitionOut:function(n){n.$el.removeClass("unloaded")}}),t.GL})})