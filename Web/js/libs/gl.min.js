define(["namespace","backbone","subroute","marionette","jquery","underscore","knockout",],function(n,t,i,r,u,f,e){var o=n.app;o.module("GL",function(n,t,i,r,u,f){return n.Views={},n.Views.KnockOutMvvmView=r.ItemView.extend({onShow:function(){this.viewModel.parentView=this,e.applyBindings(this.viewModel,u(this.el)[0])}}),n.Views.MvvmView=n.Views.KnockOutMvvmView,n.Post=function(n,i,r,f,e){var o="";t.Security.Models.loggedInUser.get("LoginToken")!=undefined&&t.Security.Models.loggedInUser.get("LoginToken")!="",o=t.Security.Models.loggedInUser.get("LoginToken"),u.ajax({type:"POST",url:"/services/Service.svc/Command",data:JSON.stringify({LoginToken:o,Command:{UniqueIdentifier:Math.floor(Math.random()*1e3+1),CommandName:n,JSON:JSON.stringify(i)}}),contentType:"application/json; charset=utf-8",success:function(n){if(n.IsSuccess){var t=JSON.parse(n.JSON);r&&r(t)}else f&&f(n.Message);e&&e(n)}})},n.PostItem=function(n,t,i,r,u){this.type=n,this.data=t,this.successCallback=i,this.failureCallback=r,this.finallyCallback=u,this.UniqueIdentifier=Math.floor(Math.random()*1e3+1)},n.BatchPost=function(){this.postItems=[],this.Add=function(t,i,r,u,f){var e=new n.PostItem(t,i,r,u,f);this.postItems.push(e)},this.Post=function(){var t,i;f.bindAll(this,"success","respond"),t="",n.GetLoginToken&&(t=n.GetLoginToken()),i=[],f.each(this.postItems,function(n){i.push({UniqueIdentifier:n.UniqueIdentifier,CommandName:n.type,JSON:JSON.stringify(n.data)})}),u.ajax({type:"POST",url:"/services/Service.svc/Commands",data:JSON.stringify({LoginToken:t,Commands:i}),contentType:"application/json; charset=utf-8",success:this.success})},this.success=function(n){f.each(n,this.respond)},this.respond=function(n){var t=f.find(this.postItems,function(t){return t.type==n.CommandName&&t.UniqueIdentifier==n.UniqueIdentifier}),i;n.IsSuccess?(i=JSON.parse(n.JSON),t.successCallback&&t.successCallback(i)):t.failureCallback&&t.failureCallback(n.Message),t.finallyCallback&&t.finallyCallback(n)}},n.ModuleRouter=i.SubRoute.extend({before:function(t){var i="";return(n.GetLoginToken&&(i=n.GetLoginToken()),i=="")?(this.navigate("/Security/Login/"+t,!0),!1):(this.UpdateModel(t.split("/")[0]),this.beforeRoute)?this.beforeRoute(t):!0},UpdateModel:function(n){if(t.Security.UserModules!=null){var r=t.Security.UserModules,i=r.where({ModName:n});i.length>=1&&i[0].set("IsSelected",!0)}}}),n.ModalRegion=i.Marionette.Region.extend({el:"#modal",initialize:function(){this.on("show",this.showModal,this)},getEl:function(n){var t=u(n);t.on("hidden",this.close);return t},showModal:function(n){n.on("close",this.hideModal,this);this.$el.parent().modal("show")},hideModal:function(){this.$el.parent().modal("hide")}}),n.TransitionRegion=i.Marionette.Region.extend({initialize:function(){},show:function(n){var t=this,u,i;this.ensureEl(),u=n.isClosed||f.isUndefined(n.$el)||this.currentView==undefined,i=n!==this.currentView,i&&this.promiseClose(n).done(function(){n.$el.addClass("baseAnimation"),n.$el.addClass("loaded"),console.log("loaded added"),n.render(),(i||u)&&t.open(n),t.currentView=n;n.$el.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){n.$el.off("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd"),n.$el.removeClass("loaded"),console.log("loaded removed")});setTimeout(function(){n.$el.addClass("ondisplay"),console.log("displayed")},1),r.triggerMethod.call(t,"show",n),r.triggerMethod.call(n,"show")})},promiseClose:function(){var i=this,t=u.Deferred(),n;if(!this.currentView||this.currentView.isClosed)return t.resolve(),t.promise();n=this.currentView.$el;n.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){n.off("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd"),n.removeClass("unloaded"),console.log("unloaded added"),i.close(),t.resolve()});return n.removeClass("ondisplay").addClass("unloaded"),console.log("ondisplay removed unloaded added"),t.promise()}}),t.GL})})